let path="/public/screenshots/calculator/",modal=document.querySelector(".modal"),tariffs=document.querySelector(".tariffs");function hover(a){a.children[0].src="/public/screenshots/calculator/offer_aH.svg",a.onclick=openTariffs,a.onmouseout=()=>{a.children[0].src="/public/screenshots/calculator/offer_a.svg"}}async function openTariffs(){function a(){27==event.keyCode?(closeTariffs(),this.removeEventListener("keyup",a)):!document.querySelector(".Open")&&this.removeEventListener("keyup",a)}if(!document.querySelector(".tariff")){let a=new FormData;a.append("ajaxSettings","page:Main:getTariffs");let b=await fetch("/Ajax.php",{method:"POST",body:a}),c=await b.json();for(let a of c){let b=document.createElement("div");b.className="tariff",b.dataset.id=a.id,tariffs.append(b);let c="",d=null;1==a.id&&(b.className+=" Actived",d=a.id,c="_A"),b.dataset.status=d,b.onclick=function(){getTariff(this,a.id)};let e=new Image;e.width="28",e.height="28",e.src="/public/screenshots/calculator/input"+c+".svg",b.append(e);let f={p:a.name,b:a.price,span:a.description};for(let a in f){let c=document.createElement(a);c.textContent=f[a],b.append(c),"b"==a&&c.insertAdjacentHTML("beforeend"," &#8381;/\u043C\u0435\u0441")}}}let b=document.querySelector(".hint");b&&b.remove(),modal.className="modal Open",document.querySelector(".background").style.width="100%",document.addEventListener("keyup",a)}function closeTariffs(){let a,b,c=document.querySelectorAll(".choosed"),d=document.querySelectorAll(".tariff"),e=[];c.forEach(a=>{e.push(a.dataset.id)}),d.forEach(c=>{a="",b=null,e.includes(c.dataset.id)&&(a="_A",b=c.dataset.id,c.classList.add("Actived")),c.children[0].src="/public/screenshots/calculator/input"+a+".svg",c.dataset.status=b});let f=document.querySelector(".error");if(f){let a=document.querySelector(".apply");a.className="apply",a.style.background="#1E1E23",f.remove()}modal.className="modal",document.querySelector(".background").style.width="0"}function getTariff(a,b){let c="tariff",d="apply",e="",f=null;a.dataset.status!=b&&(e="_A",f=b,c+=" Actived"),a.className=c,a.dataset.status=f,a.children[0].src="/public/screenshots/calculator/input"+e+".svg";let g=document.querySelector(".apply"),h=document.querySelector(".error");if(h&&(g.style.background="#1E1E23",h.remove()),0==document.querySelectorAll(".tariff.Actived").length){let a=document.createElement("div");a.className="error",a.textContent="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B \u043E\u0434\u043D\u0443 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044E!",g.parentNode.append(a),d+=" Blocked",g.style.background="#D8D8E7"}g.className=d}function apply(){if(!document.querySelector(".apply.Blocked")){document.querySelector(".show_choosed").innerText="";let a=document.querySelectorAll(".tariff.Actived");a.forEach(b=>{showTariffs(b,b.dataset.status,a.length)}),modal.className="modal",document.querySelector(".background").style.width="0",showNewPrice()}}function showTariffs(a,b,c){let d=document.querySelector(".show_choosed"),e="",f=document.createElement("div");f.className="choosed",f.dataset.id=b,d.append(f);let g=new Image;g.width="20",g.height="20",1==c&&(g.className="Blocked",e="I"),g.src="/public/screenshots/calculator/offer_d"+e+".svg",f.append(g),g.onclick=function(){deleteTariff(this,b)};let h={p:a.children[1].textContent,b:a.children[2].textContent,span:a.children[3].textContent};for(let d in h){let a=document.createElement(d);a.textContent=h[d],f.append(a)}}function deleteTariff(a,b){if(!document.querySelector(".choosed .Blocked")){let c=document.querySelectorAll(".tariff.Actived");c.forEach(a=>{a.dataset.id==b&&(a.className="tariff",a.dataset.status=null,a.children[0].src="/public/screenshots/calculator/input.svg")}),a.parentNode.remove();let d=document.querySelectorAll(".choosed");1==d.length&&(d[0].children[0].className="Blocked",d[0].children[0].src="/public/screenshots/calculator/offer_dI.svg")}else createHint(0)}function createHint(a){function b(){d.remove(),this.removeEventListener("click",b,!0)}let c={0:{0:document.querySelector(".show_choosed"),1:"\u041D\u0435\u043B\u044C\u0437\u044F \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0435\u0434\u0438\u043D\u0441\u0442\u0432\u0435\u043D\u043D\u044B\u0439 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0439 \u0442\u0430\u0440\u0438\u0444!"}};"number"!=typeof a&&(c[0][0]=a.parentNode,c[0][1]=a.dataset.hint,a=0);let d=document.createElement("div");d.className="hint",d.textContent=c[a][1],c[0][0].append(d);let e=new Image;e.src="/public/screenshots/calculator/close_w.svg",d.append(e),document.addEventListener("click",b,!0),e.onclick=b}function countParams(a,b){if("Blocked"!=a.className){let c=a.parentNode,d=c.children[0],e=c.children[1],f=e.min,g=+e.value,h="A",i="";"-"==b?(g!=f&&(e.value=g-1),g-1==f&&(h="",i="Blocked")):e.value=g+1,d.className=i,d.src="/public/screenshots/calculator/option_d"+h+".svg",showNewPrice()}}function correct(a){a.value<a.min&&(a.value=a.min,a.previousElementSibling.src="/public/screenshots/calculator/option_d.svg")}function setOption(a){let b="button Active"==a.className?"":"_on";a.src="/public/screenshots/calculator/button"+b+".svg",a.classList.toggle("Active"),showNewPrice()}function countPeriods(){"Active"!=event.target.className&&(document.querySelector(".periods .Active").className="",event.target.className="Active",showNewPrice())}function showNewPrice(){let a=+document.getElementById("users").value,b=document.getElementById("bases"),c=+b.value,d=+b.dataset.price,e=document.querySelectorAll(".button.Active"),f=0,g=+document.querySelector(".periods .Active").textContent.trim(),h=document.querySelectorAll(".choosed"),j=0;for(let a of h)j+=+a.children[2].textContent.replace(/[^0-9]/g,"");for(let a of e)f+=+a.dataset.price;let k=j*g*a+d*c+f+""+" \u20BD";document.querySelector(".price").textContent=k}async function addOrder(a){if("done"!=a.dataset.status&&confirm("\u0412\u044B \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u0437\u0430\u043A\u0430\u0437\u0430?")){let b=new FormData;b.append("ajaxSettings","page:Main:addOrder");let c={},d=[],e=[],f=document.querySelectorAll(".choosed"),g=document.querySelectorAll(".button.Active");f.forEach(a=>{e.push(a.dataset.id)}),g.forEach(a=>{d.push(a.dataset.id)}),c.offers=e,c.calculator=d,c.users=document.getElementById("users").value,c.bases=document.getElementById("bases").value,c.period=document.querySelector(".periods .Active").textContent,b.append("order",JSON.stringify(c));let h=await fetch("/Ajax.php",{method:"POST",body:b}),i=await h.text();if("\u041E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u043E"==i)a.textContent=i,a.dataset.status="done";else{let b=document.createElement("p");b.className="register",b.textContent=i,a.after(b)}}}